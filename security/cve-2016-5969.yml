- name: Protect against CVE-2016-5696
  hosts: "{{ target_hosts | default('linux') }}"
  become: yes

  tasks:
    - name: RHEL | Set sysctl_file path
      set_fact:
        sysctl_file: /usr/lib/sysctl.d/50-default.conf
      when:
        - ansible_distribution == 'RedHat'
        - ansible_distribution_major_version | version_compare('7', '=')

    - name: CVE-2016-5696 | Limit TCP challenge ACK limit
      sysctl:
        name: net.ipv4.tcp_challenge_ack_limit
        value: 999999999
        sysctl_set: yes
        sysctl_file: "{{ sysctl_file | default(omit) }}"
